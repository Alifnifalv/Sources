@using Eduegate.Framework.Mvc.Attributes

@{
    if (Request.IsAjaxRequest())
    {
        Layout = null;
    }

    Random rnd = new Random();
    var windowName = "window_" + rnd.Next().ToString();
}

<div class="windowcontainer calendar @windowName" id="CreateMyCalendar" ng-controller="MyCalendarController as vm">
    <div id="@windowName">
        <div class="pageheadername stickdiv">
            <span>
                @Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("My Calendar")
            </span>
            <div class="alignright menugroup">
                <div class="viewsummary active"></div>

                <div class="button-orange alignright" ng-click="CloseWindow();">
                    <a><i class="fa fa-close"></i></a>
                </div>
            </div>
        </div>

        <div class="menuinnertab">
            <ul>
                <li data-target="calendartab" class="active">
                    <a href="#">
                        @Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Calendar")
                    </a>
                </li>
                <li data-target="eventtab">
                    <a href="#">
                        @Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Edit Events")
                    </a>
                </li>
            </ul>
        </div>

        <div class="innertab calendartab first">
            <div class="header-list two-column-header">
                <div class="row">
                    <h2 class="text-center calendar-title">{{ vm.calendarTitle }}</h2>
                    <div class="col-md-6 btnwrap text-left pull-left">
                        <div class="btn-group">
                            <button class="btn btn-primary"
                                    mwl-date-modifier
                                    date="vm.viewDate"
                                    decrement="vm.calendarView"
                                    ng-click="vm.cellIsOpen = false">
                                @Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Previous")
                            </button>
                            <button class="btn btn-default"
                                    mwl-date-modifier
                                    date="vm.viewDate"
                                    set-to-today
                                    ng-click="vm.cellIsOpen = false">
                                @Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Today")
                            </button>
                            <button class="btn btn-primary"
                                    mwl-date-modifier
                                    date="vm.viewDate"
                                    increment="vm.calendarView"
                                    ng-click="vm.cellIsOpen = false">
                                @Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Next")
                            </button>
                        </div>
                    </div>
                    @*<br class="visible-xs visible-sm">*@
                    <div class="col-md-6 btnwrap text-right pull-right">
                        <div class="btn-group">
                            <label class="btn btn-primary" ng-model="vm.calendarView" uib-btn-radio="'year'" ng-click="vm.cellIsOpen = false">@Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Year")</label>
                            <label class="btn btn-primary" ng-model="vm.calendarView" uib-btn-radio="'month'" ng-click="vm.cellIsOpen = false">@Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Month")</label>
                            <label class="btn btn-primary" ng-model="vm.calendarView" uib-btn-radio="'week'" ng-click="vm.cellIsOpen = false">@Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Week")</label>
                            <label class="btn btn-primary" ng-model="vm.calendarView" uib-btn-radio="'day'" ng-click="vm.cellIsOpen = false">@Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Day")</label>
                        </div>
                    </div>
                </div>

                <mwl-calendar events="vm.events"
                              view="vm.calendarView"
                              view-title="vm.calendarTitle"
                              view-date="vm.viewDate"
                              on-event-click="vm.eventClicked(calendarEvent)"
                              on-event-times-changed="vm.eventTimesChanged(calendarEvent); calendarEvent.startsAt = calendarNewEventStart; calendarEvent.endsAt = calendarNewEventEnd"
                              cell-is-open="vm.cellIsOpen"
                              day-view-start="06:00"
                              day-view-end="22:59"
                              day-view-split="30"
                              cell-modifier="vm.modifyCell(calendarCell)"
                              cell-auto-open-disabled="true"
                              on-timespan-click="vm.timespanClicked(calendarDate, calendarCell)">
                </mwl-calendar>
            </div>
        </div><!--innertab-->

        <div class="innertab eventtab">
            <div class="header-list two-column-header">
                <br>
                <h2 id="event-editor">
                    @Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Edit events")
                    <button class="btn btn-primary pull-right"
                            ng-click="vm.addEvent()">
                        @Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Add new")
                    </button>
                </h2>
                <table class="table table-bordered cal-edit-grid">
                    <thead>
                        <tr>
                            <th>@Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Title")</th>
                            <th>@Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Primary color")</th>
                            <th>@Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Secondary color<")/th>
                            <th>@Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Starts at")</th>
                            <th>@Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Ends at")</th>
                            <th class="delete-btn-col">@Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Remove")</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="event in vm.events track by $index">
                            <td>
                                <input type="text" class="form-control" ng-model="event.title">
                            </td>
                            <td>
                                <input class="form-control" colorpicker type="text" ng-model="event.color.primary">
                            </td>
                            <td>
                                <input class="form-control" colorpicker type="text" ng-model="event.color.secondary">
                            </td>
                            <td>
                                <p class="input-group">
                                    <input type="text"
                                           class="form-control"
                                           readonly
                                           uib-datepicker-popup="dd MMMM yyyy"
                                           ng-model="event.startsAt"
                                           is-open="event.startOpen"
                                           close-text="Close">
                                    <span class="input-group-btn">
                                        <button type="button"
                                                class="btn btn-default"
                                                ng-click="vm.toggle($event, 'startOpen', event)">
                                            <i class="fa fa-calendar"></i>
                                        </button>
                                    </span>
                                </p>
                                <div uib-timepicker
                                     ng-model="event.startsAt"
                                     hour-step="1"
                                     minute-step="15"
                                     show-meridian="true">
                                </div>
                            </td>
                            <td>
                                <p class="input-group">
                                    <input type="text"
                                           class="form-control"
                                           readonly
                                           uib-datepicker-popup="dd MMMM yyyy"
                                           ng-model="event.endsAt"
                                           is-open="event.endOpen"
                                           close-text="Close">
                                    <span class="input-group-btn">
                                        <button type="button"
                                                class="btn btn-default"
                                                ng-click="vm.toggle($event, 'endOpen', event)">
                                            <i class="fa fa-calendar"></i>
                                        </button>
                                    </span>
                                </p>
                                <div uib-timepicker
                                     ng-model="event.endsAt"
                                     hour-step="1"
                                     minute-step="15"
                                     show-meridian="true">
                                </div>
                            </td>
                            <td>
                                <button class="btn btn-danger"
                                        ng-click="vm.events.splice($index, 1)">
                                    @Eduegate.ERP.Admin.Globalization.ResourceHelper.GetValue("Delete")
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div><!--innertab-->


        <script>
            $(document).ready(function () {
                $('.@windowName').on('click', '.menuinnertab li', function (e) {
                    if ($(this).hasClass('active')) return;
                    var menuattr = $(this).attr('data-target');
                    $('.menuinnertab li', '.@windowName').removeClass('active');
                    $(this).addClass('active');
                    $('.innertab', '.@windowName').slideUp('fast');
                    $('.innertab.' + menuattr, '.@windowName').slideDown('fast');;
                });
            });
        </script>
    </div>
</div>

 
