@using Eduegate.ERP.Admin.Globalization;
@using Eduegate.Framework.Mvc.Attributes

@{
    var fileUpload = ViewBag.Property.GetCustomAttributes(typeof(FileUploadInfoAttribute), true);

    if(fileUpload.Length == 0)
    {
        throw new Exception("No file upload infor provided for " + ViewBag.BindingPrefix);
    }

    var fileUploadInfo = (FileUploadInfoAttribute)fileUpload[0];

    <div class="controls marginBtm5">
        <div class="dropzone" style="cursor: pointer;">
            <center>@ResourceHelper.GetValue("Click here to Upload") </center>
            <div class="fallback">
                @if (fileUploadInfo.HasCrop)
                {
                    <input type="file"
                           onchange="angular.element(this).scope().UploadImageFiles(this, '@(fileUploadInfo.ActionUrl)', '@(fileUploadInfo.ImageType)',
                                '@ViewBag.BindingPrefix', '@fileUploadInfo.ImageSourceModel', angular.element(this).scope().gridModel, angular.element(this).scope().$index, angular.element(this),@fileUploadInfo.CroppingWidth, @fileUploadInfo.CroppingHeight)"
                           class="UploadFile" multiple accept="image/*" />
                }
                else
                {
                    <input type="file"
                           onchange="angular.element(this).scope().UploadImageFilesWithoutCrop(this, '@(fileUploadInfo.ActionUrl)', '@(fileUploadInfo.ImageType)',
                                    '@ViewBag.BindingPrefix', '@fileUploadInfo.ImageSourceModel', angular.element(this).scope().gridModel, angular.element(this).scope().$index, angular.element(this));"
                           class="UploadFile" multiple accept="image/*" />
                }
            </div>
        </div>

        @if (fileUploadInfo.CroppingHeight != 0 && fileUploadInfo.CroppingWidth != 0)
        {
            <div class="displaylineBlock fullwidth text-right fontSize12 lightGrey">
                Dimension:@(fileUploadInfo.CroppingWidth)w x @(fileUploadInfo.CroppingHeight)h
            </div>
        }
        <div class="panel-body">
            <div class="upload-preview">
                <div class="imgsuploaded">
                    <h2>@ResourceHelper.GetValue("Preview")</h2>
                    <div class="upload-imgwrap dropzone-previews" id="previews">
                        <div class="dz-preview dz-processing dz-image-preview" ng-repeat="imageInfo in @(ViewBag.BindingPrefix).@(fileUploadInfo.ImageSourceModel)s track by $index">
                            <div class="dz-image"> <img data-dz-thumbnail="" ng-src="{{imageInfo.FilePath}}"></div>
                            <a href="" class="dz-remove" ng-click="@(ViewBag.BindingPrefix).@(fileUploadInfo.ImageSourceModel)s.splice($index, 1);">Cancel upload</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="imgsuploaded uploaded">
                <h2>@ResourceHelper.GetValue("Uploaded Images")</h2>
                <div class="upload-imgwrap dropzone-previews" id="previews">
                    <div class="dz-preview dz-processing dz-image-preview" ng-repeat="uploadedImage in @(ViewBag.BindingPrefix).New@(fileUploadInfo.ImageSourceModel)s track by $index">
                        <div class="dz-image"> <img data-dz-thumbnail="" ng-src="{{uploadedImage.FilePath}}"> </div>
                        <a href="" class="dz-remove" ng-click="@(ViewBag.BindingPrefix).New@(fileUploadInfo.ImageSourceModel)s.splice($index,1);">Cancel upload</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="croppingImagePopover" data-popup-type="dynamicPopover" title="Cropping Image">
            <img class="croppingImage" />
        </div>
    </div>
    }
