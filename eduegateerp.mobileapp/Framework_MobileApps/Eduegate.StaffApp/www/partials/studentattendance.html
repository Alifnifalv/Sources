<div id="StudentAttendence" class="windowcontainer" ng-controller="StudentAttendanceController" ng-init="init()">

    <div class="headerBar displayFlex alignItemCenter innerHeader">
        <div class="nav-sidebar align-left">
            <div class="backtopage" ng-click="$root.goBack()">
                <img src="./images/back-arrow.png" />
            </div>
        </div>
        <!--nav-sidebar-->
        <div class="header-text"><span translate>Student attendance</span></div>
        <div class="headerRight alignright">
            <div class="notifyIcon"><i class="fa fa-bell-o"></i></div>
        </div>
    </div>

    <div class="excludeHeader">
        <div class="excludeHeaderInner fullheight noPadding displayFlex flexColumn">
            <span class="red inputerror" style="text-align: center;" ng-="ErrorMessage"
                ng-if="ErrorMessage!=''">{{ErrorMessage}}</span>
            <div class="prod-tab-wrap">
                <div class="form-horizontal panel-body bg-white pb-2 pt-4">
                    <div class="scheduleWrapper innertab subject first">
                        <div class="row">
                            <div class="col-6" style="width: 33%">
                                <label>Year</label>
                                <select id="attendanceYear" ng-change="getStudentAttendance()" class="select-arrow rounded-3"
                                    ng-model="SelectedDate.SelectedYear">
                                    <option ng-repeat="year in Years track by $index" value="{{year}}">{{year}}</option>
                                </select>
                            </div>
                            <div class="col-6" style="width: 33%">
                                <label>Month</label>
                                <select id="attendanceMonth" ng-change="getStudentAttendance()" class="select-arrow rounded-3"
                                    ng-model="SelectedDate.SelectedMonth">
                                    <option value="0">Jan</option>
                                    <option value="1">Feb</option>
                                    <option value="2">Mar</option>
                                    <option value="3">Apr</option>
                                    <option value="4">May</option>
                                    <option value="5">Jun</option>
                                    <option value="6">Jul</option>
                                    <option value="7">Aug</option>
                                    <option value="8">Sep</option>
                                    <option value="9">Oct</option>
                                    <option value="10">Nov</option>
                                    <option value="11">Dec</option>
                                </select>
                            </div>
                            <div class="col-6" style="width: 33%">
                                <label>Day</label>
                                <select id="attendanceDay" ng-change="getStudentAttendance()" class="select-arrow rounded-3"
                                    ng-model="SelectedDate.SelectedDay">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                    <option value="13">13</option>
                                    <option value="14">14</option>
                                    <option value="15">15</option>
                                    <option value="16">16</option>
                                    <option value="17">17</option>
                                    <option value="18">18</option>
                                    <option value="19">19</option>
                                    <option value="20">20</option>
                                    <option value="21">21</option>
                                    <option value="22">22</option>
                                    <option value="23">23</option>
                                    <option value="24">24</option>
                                    <option value="25">25</option>
                                    <option value="26">26</option>
                                    <option value="27">27</option>
                                    <option value="28">28</option>
                                    <option value="29">29</option>
                                    <option value="30">30</option>
                                    <option value="31">31</option>
                                </select>
                                    </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <label>Class</label>
                                <select required name="selectedClass" id="selectedClass" ng-model="selectedClass" class="select-arrow rounded-3"
                                    ng-change="ClassSectionChange()">
                                    <option ng-repeat="cls in Classes" value="{{cls.Key}}">
                                        {{cls.Value}}
                                    </option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label>Section</label>
                                <select required name="selectedSection" id="selectedSection" ng-model="selectedSection" class="select-arrow rounded-3"
                                    ng-change="ClassSectionChange()">
                                    <option ng-repeat="sec in Sections" value="{{sec.Key}}">
                                        {{sec.Value}}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <!-- <div class="PresentStatus">
                                <div class="PresentStatusbtn" ng-repeat="status in PresentStatuses">
                                    <span ng-if="status.StatusTitle == P">
                                        <input type="radio" id="radio" checked="checked" name="radio" ng-click="ChangePresentStatus(status.PresentStatusID)" /><label ng-bind="status.StatusDescription"></label>
                                    </span>
                                    <span ng-if="status.StatusTitle != P">
                                        <input type="radio" id="radio" name="radio" ng-click="ChangePresentStatus(status.PresentStatusID)" /><label ng-bind="status.StatusDescription"></label>
                                    </span>
                                </div>               
                            </div> -->
                            <!-- <div class="col-6">
                                <label>Status</label>
                                <select required name="PresentStatus" id="PresentStatus" ng-model="PresentStatus" class="select-arrow rounded-3"
                                    ng-Change="StatusChange()">
                                    <option ng-repeat="status in PresentStatuses" value="{{status.PresentStatusID}}">
                                        {{status.StatusDescription}} ({{status.StatusTitle}})
                                    </option>
                                </select>
                            </div> -->
                        </div>
                    </div>
                </div>

                <div class="container-fluid mx-0 px-0">
                    <div class="row my-3">
                      <div class="col"  ng-repeat="student in Students"
                      ng-init="current = $parent.start; $parent.start=$parent.start+1;"
                      >
                        <div  id="profile-header" class="header-wrapper fileOnlyHeader-23hdD  mb-3 Vehicle-accordion-item">
                            <div class="header-wrapper-inner pb-2">
                                <div class="resume-header-wrapper">
                                    <div class="resume-header grid-container mx-3" >
                                        <div class="grid-row centered">
                                            <div class="grid-col-md-8 grid-fill-height is-file-only-width overflow-auto">
                                                <div class="header-text shadow-border">
                                                    <div class="avatar-outer fs-mask">
                                                        <div
                                                            class="avatar-container avatar-css horizontal position-relative overflow-hidden">
                                                            <img 
                                                            ng-src="{{ParentUrlService}}/Content/ReadImageContentsByID?contentID={{student.StudentProfile}}"
                                                            on-error-src="./images/profile_img.png"
                                                            style=" background-size:cover;
                                                            background-repeat:no-repeat; top: 0;"
                                                            class="position-absolute w-100"/>
        
                                                            <!-- <div class="first-letter">A</div>
                                                            <div>N</div> -->
                                                        </div>
                                                    </div>
                                                    <div class="header-text-inner">
                                                        <div class="fullname heading3 fs-mask">{{student.StudentFullName}}</div>
                                                        <div class="location fs-mask">
                                                            
                                                            <!-- <img class="icon-3-7xg css-1xqhio eac13zx0" src = "./images/location.svg" alt="My Happy SVG"/> -->
                                                            
                                                            <span class="text-capitalize"> {{student.AdmissionNumber}}</span></div>
                                                          
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>   
                        </div>
                        <div class="attendanceStatus border-end position-relative border-bottom "
                        ng-repeat="attendence in student.attendances track by $index"
                        title="{{attendence.reason}}"
                        ng-class="{Today: attendence.day == CurrentDate.getDate() && attendence.year == CurrentDate.getFullYear() && attendence.month == CurrentDate.getMonth()}">
                        <span style="
                        position: absolute;
                        right: 24px;
                        margin-bottom: 10px;
                        top: -49px;
                        background: white;
                        padding-left: 8px;
                        font-size:20px;
                    " ng-if="(attendence.actualDate <= CurrentDate && attendence.actualDate >= attendence.feeStartDate)"
                            title="{{attendence.reason}}">
                            <!-- <div class="attendanceMore"
                                ng-click="SetAttendenceStatus('.gridItemPopupAttendence',$event, attendence, student);">
                                ...</div> -->
                            <!-- <a class="attendanceStatus" ng-click="MarkAsPresent(attendence, student);"> -->
                                <i class="attendanceStatus badge  fs-base" 
                                ng-class="{'Pressent_A': attendence.statusTitle==='A' , 'Pressent_AE': attendence.statusTitle==='AE',  'Pressent_L': attendence.statusTitle==='L', 'Pressent_NA': attendence.statusTitle==='NA', 'Pressent_P': attendence.statusTitle==='P', 'Pressent_T': attendence.statusTitle==='T', 'Pressent_TE': attendence.statusTitle==='TE', 'Pressent_UM': attendence.statusTitle==='UM', 'Pressent_W': attendence.statusTitle==='W', 'Pressent_H': attendence.statusTitle==='H'}"
                                aria-hidden="true"
                                    ng-class="{'Pressent_A': attendence.statusTitle==='A' , 'Pressent_AE': attendence.statusTitle==='AE',  'Pressent_L': attendence.statusTitle==='L', 'Pressent_NA': attendence.statusTitle==='NA', 'Pressent_P': attendence.statusTitle==='P', 'Pressent_T': attendence.statusTitle==='T', 'Pressent_TE': attendence.statusTitle==='TE', 'Pressent_UM': attendence.statusTitle==='UM', 'Pressent_W': attendence.statusTitle==='W', 'Pressent_H': attendence.statusTitle==='H'}">
                                    <span ng-bind="attendence.StatusDescription"></span>
                                </i>

                            </a>
                        </span>


                        <section class="w-100 p-2  d-flex  justify-content-end text-center">
                            <div class="btn-group p-2" ng-repeat="sts in PresentAbsentStatuses"
                            ng-init="current3 = $parent.start; $parent.start=$parent.start+1;"
                            >
                                    <input type="radio" class="btn-check" name="flexRadioDefault-{{current.toString()}}" ng-click="MarkStudentAttendance(attendence, student,sts.PresentStatusID);" value="sts.PresentStatusID"  id="option-absent{{current.toString() + current3.toString()}}" autocomplete="off"  />
                                    <label class="btn btn-secondary btn-light ripple-surface-dark btn-danger"  
                                    ng-class="{'Pressent_A': attendence.statusTitle==='A'&& sts.StatusTitle === 'A' , 'Pressent_P': attendence.statusTitle==='P' && sts.StatusTitle === 'P' , 'present-button' : sts.StatusDescription === 'Present' , 'absent-button' : sts.StatusDescription === 'Absent'}"
                                     data-mdb-ripple-color="danger"  for="option-absent{{current.toString() + current3.toString()}}">{{sts.StatusDescription}}</label>
                                    <!-- <input type="radio" ng-click="MarkAsPresentClick(attendence, student,6);" class="btn-check" value="6"  name="flexRadioDefault-{{current.toString()}}" id="option-Presnet{{current}}" autocomplete="off" />
                                    <label class="btn btn-secondary btn-light ripple-surface-dark btn-success present-button"  ng-class="{ 'Pressent_P': attendence.statusTitle==='P'}" data-mdb-ripple-color="success" for="option-Presnet{{current}}">Present</label> -->
                                  </div>
                          </section> 
                          <div class="accordion accordion-flush border-top    " id="accordionFlushExample">
                            <div class="accordion-item bg-transparent">
                                <div id="flush-collapse{{current.toString()}}" class="accordion-collapse collapse" aria-labelledby="flush-heading{{current.toString()}}" data-bs-parent="#accordionFlushExample">
                                    <div class="accordion-body p-4 mx-3">

                                    <div class="form-check p-1" ng-repeat="status in AttendanceStatuses" value="{{status.PresentStatusID}}"
                                    ng-init="current2 = $parent.start; $parent.start=$parent.start+1;"

                                    >
                                        <input class="form-check-input" type="radio" name="flexRadioDefault-{{current.toString()}}" ng-click="MarkStudentAttendance(attendence,student,status.PresentStatusID);" id="flexRadioDefault-{{current.toString()+ current2.toString()}}"/>
                                        <label class="form-check-label" for="flexRadioDefault-{{current.toString()+ current2.toString()}}"> {{status.StatusDescription}} ({{status.StatusTitle}}) </label>
                                      </div>
                                      
                             
                                </div>
                                </div>
                            
                              <h2 class="accordion-header" id="flush-heading{{current.toString()}}">
                                <button class="accordion-button accordion-button-attendece collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse{{current.toString()}}" aria-expanded="false" aria-controls="flush-collapseOne">
                                
                                </button>
                              </h2>
                         
                            </div>
                          </div>
                    </div>
                      </div>
       
                    </div>
                  </div>
             
                <!-- <div class="scheduleWrapper innertab subject first">
                    <div class="schedulerTable Vehicle-accordion-item m-3">

                         <table class="mainGrid table list-table p-0 m-0" style="  border-collapse: separate;">
                            <thead style="position: sticky; top: 0;     z-index: 3;">
                                <tr>
                                    <th class="border-end   border-bottom"
                                        ng-repeat="i in [].constructor(SelectedMonthDate+1) track by $index">{{$index
                                        != 0 ? $index : null}}</th>
                                </tr>
                                <tr>
                                    <th class="border-end   border-bottom" style="z-index: 2;"></th>
                                    <th class="border-end   border-bottom" ng-repeat="i in [].constructor(SelectedMonthDate) track by $index"
                                        ng-bind="GetWeekDays($index)"></th>
                                </tr>
                            </thead>
                            <tbody>

                                <tr class="content border-end border-bottom" ng-repeat="student in Students">
                                    <td class="columnHeader border-end border-bottom">
                                        {{student.AdmissionNumber}} - {{student.StudentFullName}}
                                    </td>

                                    <td class="attendanceStatus border-end border-bottom "
                                        ng-repeat="attendence in student.attendances track by $index"
                                        title="{{attendence.reason}}"
                                        ng-class="{Today: attendence.day == CurrentDate.getDate() && attendence.year == CurrentDate.getFullYear() && attendence.month == CurrentDate.getMonth()}">
                                        <div ng-if="(attendence.actualDate <= CurrentDate && attendence.actualDate >= attendence.feeStartDate)"
                                            title="{{attendence.reason}}">
                                            <div class="attendanceMore"
                                                ng-click="SetAttendenceStatus('.gridItemPopupAttendence',$event, attendence, student);">
                                                ...</div>
                                            <a class="attendanceStatus" ng-click="MarkAsPresent(attendence, student);">
                                                <i class="attendanceStatus" aria-hidden="true"
                                                    ng-class="{'Pressent_A': attendence.statusTitle==='A' , 'Pressent_AE': attendence.statusTitle==='AE',  'Pressent_L': attendence.statusTitle==='L', 'Pressent_NA': attendence.statusTitle==='NA', 'Pressent_P': attendence.statusTitle==='P', 'Pressent_T': attendence.statusTitle==='T', 'Pressent_TE': attendence.statusTitle==='TE', 'Pressent_UM': attendence.statusTitle==='UM', 'Pressent_W': attendence.statusTitle==='W', 'Pressent_H': attendence.statusTitle==='H'}">
                                                    <span ng-bind="attendence.statusTitle"></span>
                                                </i>

                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div> -->
            </div>
        </div>
    </div>

    <div class="attendents_Status gridItemPopup">
        <span class="tooltipArrow"></span>
        <div class="gridItemPopupInner">
            <div class="rejectContent gridItemContent" data-attr="rejectStatus">
                <p class="noMarginBtm">Present Status</p>
                <div class="controls brand">
                    <select class="validate" required="" aria-required="true" name="PresentStatus" id="PresentStatus"
                        ng-options="item as item.Value for item in PresentStatuses track by item.Key"
                        ng-model="PresentStatus"></select>
                    <!-- <i class="dropdownarrow fa fa-caret-down"></i> -->
                </div>
                <p class="noMarginBtm">Reason</p>
                <div class="controls brand">
                    <select class="validate" required="" aria-required="true" name="AttendenceReason"
                        id="AttendenceReason"
                        ng-options="item as item.Value for item in AttendenceReasons track by item.Key"
                        ng-model="AttendenceReason"></select>
                    <!-- <i class="dropdownarrow fa fa-caret-down"></i> -->
                </div>
                <p class="noMarginBtm">Notes</p>
                <div class="controls">
                    <input type="text" ng-model="Reason" />
                </div><br />
                <input type="button" value="Mark as absent" class="button-orange"
                    ng-click="MarkAsAbsent('.gridItemPopup');" />
            </div>

        </div>
    </div>
</div>

<style>


    .monthPicker .ui-datepicker-calendar {
        display: none;
    }

    .Pressent_A {
        font-weight: bold;
        color: var(--kt-danger);
        background-color: var(--kt-danger-light);
    }

    .Pressent_AE {
        color: var(--kt-warning);
        background-color: var(--kt-warning-light);
        font-weight: bold;
    }

    .Pressent_H {
        color: var(--kt-primary);
    background-color: var(--kt-primary-light);
        font-weight: bold;
    }

    .Pressent_L {
        color: var(--kt-primary);
        background-color: var(--kt-primary-light);
        font-weight: bold;
    }

    .Pressent_NA {
        color: var(--kt-light-inverse);
        background-color: var(--kt-light);
        font-weight: bold;
    }

    .Pressent_P {
        color: var(--kt-success);
        background-color: var(--kt-success-light);
        font-weight: bold;
    }

    .Pressent_T {
        color: #12616b !important;
    background-color: var(--kt-warning-light);
        font-weight: bold;
    }

    .Pressent_TE {
        color: #12616b !important;
    background-color: var(--kt-warning-light);
        font-weight: bold;
    }

    .Pressent_UM {
        color: var(--kt-light-inverse);
        background-color: var(--kt-light);
        font-weight: bold;
    }

    .Pressent_W {
        color: #be2323 !important;
    background-color: var(--kt-warning-light);
        font-weight: bold;
    }

    .mainGrid {
        max-height: 100vw;
        overflow-y: auto;
        width: 100%;
        clear: both;
        display: inline-block;
        vertical-align: top;
        position: relative;
        padding: 10px;
    }
.list-table th{
    background-color: #fff;
}
.list-table tr{
    background-color: #fff;
}



</style>