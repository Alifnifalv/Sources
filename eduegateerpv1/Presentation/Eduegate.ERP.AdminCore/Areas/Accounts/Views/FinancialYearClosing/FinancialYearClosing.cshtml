@model Eduegate.Web.Library.ViewModels.AccountTransactions.FinancialYearClosing.FinancialYearClosingViewModel

@{
    if (Context.Request.Headers["X-Requested-With"] == "XMLHttpRequest")
    {
        Layout = null;
    }

    Random rnd = new Random();
    var windowName = "window_" + rnd.Next().ToString();
}

<div id="FinancialYearClosing" class="windowcontainer"
     ng-controller="FinancialYearClosingController"
     ng-init="init(@Newtonsoft.Json.JsonConvert.SerializeObject(Model),'@windowName')">
    <div class="main-page row g-0">

        <div class="window-tab preload-overlay" style="display:none;">
            <div class="preloader"><img src="/Images/preloader.GIF" width="32" height="32" alt="Loading" /></div>
        </div>
        <div class="col-md-12">
            <div class="app-content  flex-column-fluid p-0">
                <div class="row gy-0 g-xl-2">
                    <p class="d-inline-flex gap-1">
                        <form class="col-12">
                            <div class="w-100 card">
                                <div class="card-header" style="min-height:auto; padding:0.5rem 1rem ; align-items:center" data-bs-toggle="collapse" data-bs-target="#collapseBudget" aria-expanded="false" aria-controls="collapseExample">
                                    <legend class="col-lg-2">Financial Year Closing</legend>
                                    <button class="button-orange p-1" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBudget" aria-expanded="false" aria-controls="collapseExample">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-down-fill" viewBox="0 0 16 16">
                                            <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
                                        </svg>
                                    </button>
                                </div>
                                <div class="card-body collapse show" id="collapseBudget">
                                    <div class="row gy-0 g-xl-2">
                                        <div class="col-lg-4">
                                            <span class="form-group">
                                                <span class="controls w-75">
                                                    <label>Company Name : </label>
                                                    <span class="controls brand">
                                                        <ui-select style="width: 100%;" ng-model="company" ng-change="CompanyDetails(company)" ng-disabled="IsEditScreen"
                                                                   theme="select2" class="pos-txt" sortable="true" name="SelectedCompany" id="SelectedCompany">
                                                            <ui-select-match placeholder="Search">{{$select.selected.Value}}</ui-select-match>
                                                            <ui-select-choices repeat="data in Company | filter:$select.search">{{data.Value}}</ui-select-choices>
                                                        </ui-select>
                                                    </span>
                                                </span>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="d-flex flex-stack pt-10">
                                        <!--begin::Wrapper-->
                                        <div class="me-2">
                                        </div>
                                        <!--end::Wrapper-->
                                        <!--begin::Wrapper-->
                                        <div>
                                            <button type="button" class="btn btn-sm  btn-primary" ng-disabled="IsCompSelected" ng-click="SaveEntries()">
                                                <span class="indicator-label">
                                                    Save Entries

                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download fs-3 ms-2 me-0" viewBox="0 0 16 16">
                                                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                                                        <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
                                                    </svg>
                                                </span>
                                            </button>

                                            <button type="button" class="btn btn-sm btn-primary" ng-click="ResetFields()">
                                                Reset
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-repeat  fs-3 ms-1 me-0" viewBox="0 0 16 16">
                                                    <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z" />
                                                    <path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z" />
                                                </svg>
                                            </button>

                                        </div>
                                        <!--end::Wrapper-->
                                    </div>

                                    <!-- New Section for Financial Year Information -->
                                    <div class="row gy-0 g-xl-2 mt-4">
                                        <!-- Previous Financial Year -->
                                        <div class="col-lg-6">
                                            <div class="card">
                                                <div class="card-body d-flex flex-column gap-4">
                                                    <h5 class="d-flex justify-content-center"><strong>Previous Financial Year</strong></h5>
                                                    <span class="controls w-50">
                                                        <label>Financial Year: </label>
                                                        <span class="controls brand">
                                                            <!-- Ensure ng-model is correctly bound to MainData.PrvFY -->
                                                            <ui-select style="width: 100%;"
                                                                       ng-model="MainData.PrvFY"
                                                                       theme="select2"
                                                                       class="pos-txt"
                                                                       sortable="true"
                                                                       name="SelectedPrvFY"
                                                                       id="SelectedPrvFY">
                                                                <!-- Display selected fiscal year -->
                                                                <ui-select-match placeholder="Select Fiscal Year">{{$select.selected.Value}}</ui-select-match>
                                                                <!-- Loop through FiscalYears and display each option -->
                                                                <ui-select-choices repeat="year in FiscalYears | filter: $select.search">
                                                                    {{year.Value}}
                                                                </ui-select-choices>
                                                            </ui-select>
                                                        </span>
                                                    </span>

                                                    <span>Date From : {{MainData.PrvFromDateString}}</span></span>
                                                    <span>Date To : {{MainData.PrvToDateString}}</span>
                                                    <span>Audit Type : {{MainData.PrvAuditTypeName}}</span>
                                                    <span>Audit Status : {{MainData.PrvStatusName}}</span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-lg-6">
                                            <div class="card">
                                                <div class="card-body d-flex flex-column gap-4">
                                                    <h5 class="d-flex justify-content-center"><strong>Current Financial Year</strong></h5>
                                                    <span class="controls w-50">
                                                        <label>Financial Year: </label>
                                                        <span class="controls brand">
                                                            <!-- Ensure ng-model is correctly bound to MainData.PrvFY -->
                                                            <ui-select style="width: 100%;"
                                                                       ng-model="MainData.CrtFY"
                                                                       theme="select2"
                                                                       class="pos-txt"
                                                                       sortable="true"
                                                                       name="SelectedCrtFY"
                                                                       id="SelectedCrtFY">
                                                                <!-- Display selected fiscal year -->
                                                                <ui-select-match placeholder="Select Fiscal Year">{{$select.selected.Value}}</ui-select-match>
                                                                <!-- Loop through FiscalYears and display each option -->
                                                                <ui-select-choices repeat="year in FiscalYears | filter: $select.search">
                                                                    {{year.Value}}
                                                                </ui-select-choices>
                                                            </ui-select>
                                                        </span>
                                                    </span>

                                                    <span>Date From : {{MainData.CrStartDateString}}</span></span>
                                                    <span>Date To : {{MainData.CrEndDateString}}</span>
                                                    <span>Audit Type : {{MainData.CrntAuditTypeName}}</span>
                                                    <span>Audit Status : {{MainData.CrntStatusName}}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row gy-0 g-xl-2 mt-4">
                                        <div class="col-lg-6">
                                            <div class="card" ng-show="!IsCompSelected">
                                                <div class="main-page relativePosition fullheight" id="sortable">
                                                    <h5 class="d-flex justify-content-center"><strong>Closing Balance Sheet</strong></h5>
                                                    <div class="leftnav-tree-blk">
                                                        <div class="leftnav-tree-filter">
                                                            <div class="d-flex" style="text-decoration-line: underline; margin-bottom: 10px;">
                                                                <span class="flexAuto label" style="width: 60%;">Particular</span>
                                                                <span class="d-flex" style="width: 20%; justify-content: center;">Ledger</span>
                                                                <span class="d-flex" style="width: 35%; justify-content: end;">Amount</span>
                                                            </div>
                                                            <ul class="category-list">
                                                                <li ng-repeat="node in Nodes" ng-include="'nestedTreeView'"></li>
                                                            </ul>
                                                        </div>
                                                    </div>

                                                    <div class='bounce-wrapper' id='shoLoad' ng-show="IsCompSelected">
                                                        <div class='three-bounce-inner'>
                                                            <div class='bounce-item bi-item1'></div>
                                                            <div class='bounce-item bi-item2'></div><div class='bounce-item bi-item3'>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="card" ng-show="!IsCompSelected">
                                                <div class="main-page relativePosition fullheight" id="sortable">
                                                    <h5 class="d-flex justify-content-center"><strong>Opening Trial Balance</strong></h5>
                                                    <div class="leftnav-tree-blk">
                                                        <div class="leftnav-tree-filter">
                                                            <div class="d-flex" style="text-decoration-line: underline; margin-bottom: 10px;">
                                                                <span class="flexAuto label" style="width: 60%;">Particular</span>
                                                                @* <span class="d-flex gap-8" style="width: 20%; justify-content: center;">Ledger</span> *@
                                                                <span class="d-flex gap-8" style="width: 35%; justify-content: end;">Amount</span>
                                                            </div>
                                                            <ul class="category-list">
                                                                <li ng-repeat="node in Nodes1" ng-include="'nestedTreeView'"></li>
                                                            </ul>
                                                        </div>
                                                    </div>

                                                    <div class='bounce-wrapper' id='shoLoad1' ng-show="IsCompSelected">
                                                        <div class='three-bounce-inner'>
                                                            <div class='bounce-item bi-item1'></div>
                                                            <div class='bounce-item bi-item2'></div><div class='bounce-item bi-item3'>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/ng-template" id="nestedTreeView">
    <a href="#" id="menuLink_{{node.NodeID}} " class="parent_li_view">
    <!-- Node Data Row -->
    <span class="displayFlex alignCenter">
        <span class="tree_icon"></span>
        <span class="d-flex alignCenter justify-content-between flexAuto label gap-20" ng-click="FireEvent($event, node)">
            <div>
                <i class='fa fa-plus-square-o'></i>
                <span>
                    <label class="trimHolder">{{node.NodeName}}</label>
                </span>
            </div>
            <span class="d-flex" style="justify-content: center; float:right;padding-right: 6px; color:#333">{{node.Ledger}}</span>
            <span class="d-flex" style="justify-content: end; float:right;padding-right: 6px; color:#333">{{node.Amount}}</span>
        </span>
    </span>
    </a>
    <ul ng-if="node.Nodes && node.Nodes.length > 0" style="display:none">
        <li ng-repeat="node in node.Nodes" ng-include="'nestedTreeView'" ng-class=""
    @*{'parent_li': node.Nodes.length > 0, 'nosubitem': node.Nodes.length == 0}*@>
            <a href="#" id="menuLink_{{node.NodeID}} " class="parent_li_view">
                <span>
                    <label>{{node.NodeName}}</label>
                </span>
                <span>
                    <i class='fa fa-plus-square-o' ng-click="FireEvent($event, node)"></i>
    @*<img src="{{node.ImageUrl}}">*@
                    <label style="padding: 4px 0 0 5px;" class="trimHolder" ng-click="FireEvent($event, node)">{{node.NodeName}}</label>
                    <span style="float:right;padding-right: 6px;">
                        <i class="fa fa-pencil editiconright"></i>
                        <i class="fa fa-plus addiconright"></i>
                    </span>
                </span>
            </a>
        </li>
    </ul>
</script>
