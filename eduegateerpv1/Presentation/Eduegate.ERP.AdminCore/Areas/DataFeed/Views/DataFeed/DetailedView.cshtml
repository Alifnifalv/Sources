@using Eduegate.Services.Contracts.Enums
@{
    Layout = null;
    var viewIID = Eduegate.Services.Contracts.Enums.SearchView.DataFeed;
    Random rnd = new Random();
    var windowName = "window_" + rnd.Next().ToString();
}

<div id="@windowName" class="summary-wrap" ng-controller="SummaryViewController" ng-init="SummaryViewInit('@windowName', '@viewIID', @ViewBag.IID,'@DynamicViews.DataFeed');">
    <div class="preload-overlay" style="display:block;">
        <div class="preloader">
            <img src="/Images/preloader.GIF" width="32" height="32" alt="Loading" />
            <div class="loadertextwrap">
                <div id="Loadertext">
                    <div id="fadetext_1" class="loadingtext">L</div>
                    <div id="fadetext_2" class="loadingtext">o</div>
                    <div id="fadetext_3" class="loadingtext">a</div>
                    <div id="fadetext_4" class="loadingtext">d</div>
                    <div id="fadetext_5" class="loadingtext">i</div>
                    <div id="fadetext_6" class="loadingtext">n</div>
                    <div id="fadetext_7" class="loadingtext">g</div>
                    <div id="fadetext_8" class="loadingtext">.</div>
                    <div id="fadetext_9" class="loadingtext">.</div>
                    <div id="fadetext_10" class="loadingtext">.</div>
                </div>
                <span class="canceloperation" ng-click="CloseSummaryPanel($event);">Cancel</span>
            </div>
        </div>
    </div>
    <div class="summary-header">
        <div class="summary-controls">
            <ul class="summary-tab">
                <li class="summary-tab-list active" title="DataFeed Details" content-tab="DataFeed"><i class="fa fa-file-text"></i></li>
            </ul>
            <div class="alignright panelcontrols">
                <span class="remove" ng-click="CloseSummaryPanel($event);">x</span>
                <span class="minmax"></span>
            </div>
        </div>
    </div>
    <div class="quickviewwrap">
        <div id="DataFeed" class="summarytab-content first">
            <h4>DataFeed Details</h4>
            <div class="summary-tab-inner">
                <div class="summary-content">
                    <div class="label-value-box">
                        <div class="label-value-box-inner">
                            <span class="label-style">Data Feed Type ID</span>
                            <span class="link-content" ng-bind="ViewModels.@(DynamicViews.DataFeed).DataFeedTypeID"></span>
                        </div>
                        <div class="label-value-box-inner">
                            <span class="label-style">Name</span>
                            <span class="link-content" ng-bind="ViewModels.@(DynamicViews.DataFeed).Name"></span>
                        </div>
                        <div class="label-value-box-inner">
                            <span class="label-style">Template Name</span>
                            <span class="link-content" ng-bind="ViewModels.@(DynamicViews.DataFeed).TemplateName"></span>
                        </div>
                    </div>
                </div>

                <div class="summary-content" ng-model="DataFeedModel" ng-controller="DataFeedControllerV2" ng-init="Init('@windowName', @Newtonsoft.Json.JsonConvert.SerializeObject(new Eduegate.Web.Library.ViewModels.DataFeedViewModel() { DataFeedTypeID = int.Parse(ViewBag.IID.ToString()) }), @viewIID)">
                    <div class="label-value-box">
                        <div class="label-value-box-inner">
                            <span class="label-style">Download Template</span>
                            <span class="link-content"><a href="" class="button-orange" ng-click="DownloadTemplate(@ViewBag.IID);">Download Template</a></span>  
                        </div>
                        <div class="label-value-box-inner">
                                <div class="fullwidth alignleft uploadfield" class="label-style">
                                    <input type="file" class="uploadexcel" file-model="feedFile"
                                           accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" />
                                    <span><input type="text" class="filename" /></span>
                                    <button class="button-orange uploadfile">Upload File</button>
                                </div>
                        </div>
                        <div class="label-value-box-inner">
                            <span class="label-style"></span>
                            <span class ="link-content">
                                <span class="label-style"><label class="alignleft"><input type="checkbox" />&nbsp; Ignore Errors</label></span>
                            </span>                        
                        </div>
                        <div class="label-value-box-inner">
                            <span class="label-style"></span>
                            <span class="link-content">
                                <button class="button-orange" ng-click="InitiateFeed(@ViewBag.IID);">Process Import</button>
                            </span>
                        </div>
                        <div class="label-value-box-inner">
                            <div class="imported-filestatus" id="divUploadedFiles">

                            </div>
                        </div>
                </div>                

                <script>
                    function getfilename() {
                        $('.uploadexcel').change(function () {

                            var showfilename = $(".uploadexcel").val().split('\\').pop().split('/').pop();
                            $('.filename').val(showfilename);
                        });
                    }
                    $(document).ready(function () {
                        $('.uploadfile').on('click', function () {
                            $('.uploadexcel').trigger('click');
                            getfilename();
                        });
                        $('.filename').on('click', function () {
                            $('.uploadexcel').trigger('click');
                        });
                        $('.filename').focus(function () {
                            $('.uploadexcel').trigger('click');
                            getfilename();
                        });
                    });
                </script>

            </div>

        </div>
    </div>
</div>
</div>

<script>
    $(document).ready(function () {

        //Cosing the summary view
        $('#@windowName .summary-panel .remove').on('click', function () {
            $('.pagecontent', '#@windowName').removeClass('summaryview');
        });

        //Details summary view active on click
        $('#@windowName .summary-toggle .sum_toggleheader').on('click', function () {
            $(this).parent().toggleClass('show');

            if ($(this).parent().hasClass('show')) {
                $(this).parent().addClass('show');
                $(this).parent().find('.sum_togglecontent').slideDown('fast');
            }
            else {
                $(this).parent().removeClass('show');
                $(this).parent().find('.sum_togglecontent').slideUp('fast');
            }
        });

        $('#@windowName .summarytab-content.first').show(); //Details view showing first

        //Sales view will be active on click chart icon
        $('#@windowName .summary-tab .summary-tab-list').on('click', function () {
            $('.summary-tab-list', '#@windowName').removeClass('active');
            $('.summarytab-content', '#@windowName').hide();
            $(this).addClass('active');
            $('#' + $(this).attr('content-tab'), '#@windowName').fadeIn('medium');
        });
    });
</script>