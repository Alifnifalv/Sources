@model Eduegate.Services.Contracts.Logging.ActivityDTO
@using Eduegate.Services.Contracts.Enums

@{
    Layout = null;

    //TODO: Check later
    //var viewIID = Eduegate.Services.Contracts.Enums.SearchView.Activity;
    var viewIID = 0;

    Random rnd = new Random();
    var windowName = "window_" + rnd.Next().ToString();
    ViewBag.IID = string.IsNullOrEmpty(Model.ReferenceID) ? long.Parse(Model.ReferenceID) : 0;
}

<div id="@windowName" class="summary-wrap" ng-controller="SummaryViewController" ng-init="SummaryViewInit('@windowName', '@viewIID', @Model.ActivityID,'@DynamicViews.JobEntry');">
    <div class="preload-overlay" style="display:block;">
        @{
            @await Html.PartialAsync("_PreLoader");
        }
    </div>

    <div class="summary-header">
        <div class="summary-controls">
            <ul class="summary-tab">
                <li class="summary-tab-list active" title="Comments" content-tab="comments"><i class="fa fa-comment-o"></i></li>
                @if (Model.ActivityTypeID == 2)
                {
                    <li class="summary-tab-list" title="Workflow" content-tab="workflow"><i class="fa fa-cogs"></i></li>
                }
            </ul>
            <div class="alignright panelcontrols">
                <span class="remove" ng-click="CloseSummaryPanel($event);">x</span>
                <span class="minmax"></span>
            </div>
        </div>
    </div>
    <div class="quickviewwrap">
        <div id="comments" class="summarytab-content first">
            <div class="summary-tab-inner">
                @{
                    //TODO: Check later
                    // Html.RenderAction("Comment", "Mutual", new { area = "", type = Eduegate.Infrastructure.Enums.EntityTypes.Alerts, referenceID = Model.ReferenceID });
                }
            </div>
        </div>
        @{ 
            if(Model.ActivityTypeID == 2) { 
                <div id="workflow" class="summarytab-content">
                    <div class="summary-tab-inner">
                        @{
                            //TODO: Check later
                            // Html.RenderAction("GetWorkflowDetails", "Workflow", new { area = "Workflows", headID = Model.ReferenceID });
                        }
                    </div>
                </div>
            }
        }
    </div>
</div>

<script>
       $(document).ready(function () {
        $('#@windowName .summary-panel .remove').on('click', function () {
            $('.pagecontent', '#@windowName').removeClass('summaryview');
        });

        $('#@windowName .summary-toggle .sum_toggleheader').on('click', function () {
            $(this).parent().toggleClass('show');

            if ($(this).parent().hasClass('show')) {
                $(this).parent().addClass('show');
                $(this).parent().find('.sum_togglecontent').slideDown('fast');
            }
            else {
                $(this).parent().removeClass('show');
                $(this).parent().find('.sum_togglecontent').slideUp('fast');
            }
        });

        $('#@windowName .summarytab-content.first').show();

        $('#@windowName .summary-tab .summary-tab-list').on('click', function () {
            $('.summary-tab-list', '#@windowName').removeClass('active');
            $('.summarytab-content', '#@windowName').hide();
            $(this).addClass('active');
            $('#' + $(this).attr('content-tab'), '#@windowName').fadeIn('medium');
        });
    });
</script>
